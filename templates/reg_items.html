{% extends "index.html" %}
{% block section %}
<style>
    body {
        font-family: 'Pretendard', sans-serif;
        background-color: #FFEFD5;
        margin: 0;
        padding: 0;
    }

    #main-container {
        display: flex;
        flex-direction: column;
        max-width: 600px;
        margin: 20px auto;
        background-color: #ffffff;
        border: 1px solid #efefef;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    h2 {
        font-size: x-large;
        text-align: center;
        color: #1E3269;
        margin-bottom: 20px;
    }

    form {
        display: flex;
        flex-direction: column;
    }

    label {
        margin-bottom: 10px;
        font-size: medium;
        color: #1E3269;
    }

    input[type="text"],
    input[type="password"],
    input[type="file"],
    select {
        width: calc(100% - 20px); /* ì—¬ë°±ì„ í¬í•¨í•œ ìµœëŒ€ ë„ˆë¹„ */
        padding: 10px;
        margin-bottom: 20px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .checkbox-label {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
    }

    #recommand-container {
        display: none;
        align-items: center;
    }

    #recommand {
        margin-right: 10px;
        color: #1E3269;
        font-size: small;
    }

    #okprice {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-bottom: 20px;
    }

    #image-preview {
        max-width: 100%;
        height: auto;
        margin-bottom: 20px;
        border-radius: 4px;
    }

    .submitBtn {
        width: 150px;
        height: 35px;
        background: #1E3269;
        color: white;
        font-size: 15px;
        border-radius: 8px;
        border-style: none;
        font-family: "Pretendard";
        cursor: pointer;
        margin: 0 auto; /* ê°€ìš´ë° ì •ë ¬ì„ ìœ„í•´ ì¶”ê°€í•œ ë¶€ë¶„ */
        display: block; /* ê°€ìš´ë° ì •ë ¬ì„ ìœ„í•´ ì¶”ê°€í•œ ë¶€ë¶„ */
    }
    
    .decideBtn{
        width: 200px;
        height: 25px;
        background: #e6e6e6;
        font-size: 14px;
        border-radius: 8px;
        border-style: none;
        font-family: "Pretendard";
        margin-bottom: 20px;
    }
    .decideBtn:hover {
        background: #d9d9d9;
    }

    .submitBtn:hover {
        background: #305490;
    }
</style>

<div id="main-container">
    <h2>ã…£ ìƒí’ˆ ë“±ë¡ ã…£</h2>
    <form action="/submit_item_post" method="post" enctype="multipart/form-data">
        <label for="name">ìƒí’ˆëª…:</label>
        <input type="text" name="name" id="name" required>

        <label for="seller">íŒë§¤ì ID:</label>
        <input type="text" name="seller" id="seller" value="{{session['id']}}" required>

        <label for="addr">ê±°ë˜í¬ë§ì¥ì†Œ:</label>
        <input type="text" name="addr" id="addr" required>

        <label for="price">êµ¬ë§¤ê°€ê²©:</label>
        <input type="text" name="price" id="price" required>

        <label for="category">ì¹´í…Œê³ ë¦¬:</label>
        <select id="category" name="category">
            <option value="ì˜ë¥˜" selected>ì˜ë¥˜</option>
            <option value="ë·°í‹°">ë·°í‹°</option>
            <option value="ë„ì„œ">ë„ì„œ</option>
            <option value="ê°€êµ¬">ê°€êµ¬</option>
            <option value="ë¬¼í’ˆ">ë¬¼í’ˆ</option>
            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
        </select>

        <label for="time">êµ¬ë§¤ì‹œê¸°:</label>
        <select id="time" name="time">
            <option value="1ê°œì›” ì´ë‚´" selected>1ê°œì›” ì´ë‚´</option>
            <option value="3ê°œì›” ì´ë‚´">3ê°œì›” ì´ë‚´</option>
            <option value="6ê°œì›” ì´ë‚´">6ê°œì›” ì´ë‚´</option>
            <option value="12ê°œì›” ì´ë‚´">12ê°œì›” ì´ë‚´</option>
        </select>

        <label for="status">ì‚¬ìš©íšŸìˆ˜:</label>
        <select id="status" name="status">
            <option value="ë¯¸ì‚¬ìš©" selected>ë¯¸ì‚¬ìš©</option>
            <option value="1-5íšŒ">1-5íšŒ</option>
            <option value="5íšŒ ì´ˆê³¼">5íšŒ ì´ˆê³¼</option>
        </select>

        <div class="checkbox-label" id="recommand-container">
            <div style="font-size: 16px; color: red;" id="recommand"></div>
            <label for="sellWithRecommand" style="margin-bottom: 0; font-weight:600;">ì¶”ì²œ íŒë§¤ê°€ë¡œ íŒë§¤í•˜ê¸°</label>
            <input type="checkbox" id="sellWithRecommand">
        </div>

        <label for="okprice">ìµœì¢… íŒë§¤ê°€:</label>
        <input type="text" name="okprice" id="okprice">
        <input type="hidden" name="okprice" id="okprice-hidden" value="">
        <input type="hidden" name="level" id="level">
        <input type="button" onclick="calculateLevel()" value="ìµœì¢… íŒë§¤ê°€ë¡œ ê²°ì •í•˜ê¸°" class="decideBtn">
        <label for="img">ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œ í•´ì£¼ì„¸ìš”:</label>
        <input type="file" name="file" onchange="showImagePreview(this)">
        <img id="image-preview">

        <input class="submitBtn" type="submit" value="ìƒí’ˆ ë“±ë¡í•˜ê¸°">
    </form>
</div>

<script>
    var priceInput = document.getElementById("price");
    var statusSelect = document.getElementById("status");
    var timeSelect = document.getElementById("time");
    var sellWithRecommandCheckbox = document.getElementById("sellWithRecommand");
    var recommandPrice = document.getElementById("recommand");
    var okPriceInput = document.getElementById("okprice");
    var okPriceHiddenInput = document.getElementById("okprice-hidden");

    function calculateRecommandPrice() {
        var selectedStatus = statusSelect.value;
        var selectedTime = timeSelect.value;

        var statusWeight = 1.0;
        if (selectedStatus === "ë¯¸ì‚¬ìš©") {
            statusWeight = 0.95;
        } else if (selectedStatus === "1-5íšŒ") {
            statusWeight = 0.8;
        } else if (selectedStatus === "5íšŒ ì´ˆê³¼") {
            statusWeight = 0.6;
        }

        var timeWeight = 1.0;
        if (selectedTime === "1ê°œì›” ì´ë‚´") {
            timeWeight = 0.9;
        } else if (selectedTime === "3ê°œì›” ì´ë‚´") {
            timeWeight = 0.8;
        } else if (selectedTime === "6ê°œì›” ì´ë‚´") {
            timeWeight = 0.7;
        } else if (selectedTime === "12ê°œì›” ì´ë‚´") {
            timeWeight = 0.5;
        }

        var calculatedPrice = parseInt(priceInput.value) * statusWeight * timeWeight;
        var recommandText = "ì¶”ì²œ íŒë§¤ê°€: " + calculatedPrice.toFixed(0) + " ì›";
        recommandPrice.textContent = recommandText;
        
        if (sellWithRecommandCheckbox.checked) {
            okPriceInput.value = calculatedPrice.toFixed(0);
            document.getElementById("okprice").value = calculatedPrice.toFixed(0);
        } 

        document.getElementById("recommand-container").style.display = "flex";
        
        return calculatedPrice;
    }

    function toggleRecommandPrice() {
        calculateRecommandPrice();
    }
    
    function calculateLevel() {
        
        var okPrice = parseFloat(okPriceInput.value);
        var recPrice = calculateRecommandPrice();
        var weight = (recPrice - parseFloat(priceInput.value)) * 0.25;
        var levelInput = document.getElementById("level");

        
        if(okPrice<recPrice){
            levelInput.value = "ğŸ’™ë§¤ìš°ì°©í•´ìš”";
        } else if(okPrice == recPrice){
            levelInput.value = "âœ…í•©ë¦¬ì ì´ì—ìš”";
        } else {
            levelInput.value = "ğŸ’”ë¹„ì‹¸ìš”";
        }
    }
    
    function showImagePreview(input) {
        var fileInput = input;
        var preview = document.getElementById('image-preview');

        if (fileInput.files && fileInput.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.style.display = 'block'; // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
            };

            reader.readAsDataURL(fileInput.files[0]);
        } else {
            preview.src = '';
            preview.style.display = 'none'; // íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šìœ¼ë©´ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ìˆ¨ê¹€
        }
    }
    

    priceInput.addEventListener("input", calculateRecommandPrice);
    statusSelect.addEventListener("change", calculateRecommandPrice);
    timeSelect.addEventListener("change", calculateRecommandPrice);
    sellWithRecommandCheckbox.addEventListener("change", toggleRecommandPrice);
    
    var decideBtn = document.querySelector(".decideBtn");

    decideBtn.addEventListener("click", function () {
        // ë°°ê²½ìƒ‰ì„ ì–´ë‘ìš´ íšŒìƒ‰(#444444)ìœ¼ë¡œ ë³€ê²½
        decideBtn.style.backgroundColor = "#444444";
        // í…ìŠ¤íŠ¸ ìƒ‰ìƒì„ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½
        decideBtn.style.color = "white";
        
        decideBtn.classList.add("emoji-show");
    });
    
</script>
{% endblock section %}